import{g as o,a as S,c as T,k as P,f as k,l as N,b as C,s as I,p as M}from"./firebace-Cb3kG9CG.js";import{c as E,g as x,a as A,f as O}from"./requests-8AYIeyfP.js";import{c as D}from"./render-prod-cards-BG07nqjv.js";import{r as H}from"./render-news-BruYhvYD.js";const p=o(".avatar__img img"),u=o(".avatar__reit span"),f=o(".info__name"),m=o(".info__all span"),_=o(".info__success span"),g=o(".info__about");async function R(e,t){let n=0;e.score.forEach(a=>{n+=Number(a)});const r=n/e.score.length,s={id:e.id,img:e.img,name:e.name,surname:e.surname,allCollections:e.myProds.length,succsesfulCollections:0,dateOfRegister:e.dateOfRegister,score:Math.round(r),about:e.about};e.myProds.forEach(a=>{t.forEach(l=>{l.id===a&&l.status&&s.succsesfulCollections++})}),$(s)}function $(e){!p||!u||!f||!m||!_||!g||(p.src=e.img,u.innerText=e.score.toString(),f.innerText=e.name+" "+e.surname,m.innerText=e.allCollections.toString(),_.innerText=e.succsesfulCollections.toString(),g.innerText=e.about)}const w=o(".avatar__btn"),i=o(".popup"),v=o(".popup__title span"),B=o(".popup__close"),c=S(".popup__star"),F=o(".popup__btn"),K=T.get("UID"),h=o(".avatar__reit span");function j(e){if(K){w?.addEventListener("click",()=>{i?.classList.add("popup_active"),d(),v&&(v.innerText=e.name+" "+e.surname);for(let t=0;t<c.length;t++)c[t].innerHTML=`
          <svg>
              <use href="#star-black"></use>
          </svg>
        `}),q(),d(),z(e);return}w?.addEventListener("click",()=>{window.location.href="/Kindred/log-in.html"})}function q(){B?.addEventListener("click",()=>{i?.classList.contains("popup_active")&&i?.classList.remove("popup_active"),d()})}function d(){const e=o("body");if(e){if(i?.classList.contains("popup_active")){e.style.overflow="hidden";return}e.style.overflow="auto"}}function z(e){c&&c.forEach(t=>{t.addEventListener("click",async()=>{const n=Number(t.id);for(let s=0;s<c.length;s++)c[s].innerHTML=`
          <svg>
              <use href="${s<n?"#star":"#star-black"}"></use>
          </svg>
        `;const r=await E(e.id);r&&G(n,r)})})}function G(e,t){F?.addEventListener("click",async()=>{try{const n=P(k,"users",t.id),s=[...t.score||[],e];if(await N(n,{score:s}),i?.classList.remove("popup_active"),!h)return;let a=0;s.forEach(y=>{a+=Number(y)});const l=a/s.length;h.innerText=Math.round(l).toString()}catch(n){console.error(n)}})}const b=o(".user-prods__title span");async function J(e,t,n){if(!b)return;b.innerHTML=e.name+" "+e.surname;const r=t.filter(s=>s.userId===e.id);console.log(r),await D(".user-prods__prods",r,n)}const L=o(".user-news__title span");async function Q(e,t,n){if(!L)return;L.innerHTML=e.name+" "+e.surname;const r=t.filter(s=>s.userId===e.id);await H(".user-news__news",r,n)}const V=new URLSearchParams(window.location.search),U=V.get("id")||void 0;document.addEventListener("DOMContentLoaded",async()=>{if(!U)return;const e=await x(),t=await E(U),n=await A(),r=await O();!e||!t||!n||!r||(await R(t,e),await J(t,e,n),await Q(t,r,n),C(),j(t),I())});document.addEventListener("loadingIsFinished",()=>{M()});
